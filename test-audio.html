<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    button {
      padding: 15px 30px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 5px;
    }
    button:hover {
      background: #1976D2;
    }
    #console {
      background: #000;
      color: #0f0;
      padding: 20px;
      margin-top: 20px;
      border-radius: 5px;
      font-family: monospace;
      height: 400px;
      overflow-y: auto;
    }
    .info { color: #2196F3; }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .warning { color: #ff9800; }
  </style>
</head>
<body>
  <h1>Audio Test Page</h1>
  <p>This page will help diagnose the sold.mp3 audio issue.</p>
  
  <div>
    <button onclick="testSoldSound()">Test Sold Sound</button>
    <button onclick="testUnsoldSound()">Test Unsold Sound</button>
    <button onclick="clearConsole()">Clear Console</button>
  </div>
  
  <div id="console"></div>
  
  <audio id="soldSound" preload="auto">
    <source src="./assets/sold.mp3" type="audio/mpeg">
  </audio>
  <audio id="unsoldSound" preload="auto">
    <source src="./assets/unsold.mp3" type="audio/mpeg">
  </audio>
  
  <script>
    const consoleDiv = document.getElementById('console');
    const soldSound = document.getElementById('soldSound');
    const unsoldSound = document.getElementById('unsoldSound');
    
    function log(message, type = 'info') {
      const p = document.createElement('p');
      p.className = type;
      p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      consoleDiv.appendChild(p);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
      console.log(message);
    }
    
    function clearConsole() {
      consoleDiv.innerHTML = '';
    }
    
    // Initialize audio
    soldSound.volume = 1.0;
    unsoldSound.volume = 1.0;
    
    soldSound.addEventListener('canplaythrough', () => {
      log('✓ Sold sound ready to play', 'success');
      log(`  Ready state: ${soldSound.readyState}`, 'info');
      log(`  Duration: ${soldSound.duration}s`, 'info');
      log(`  Source: ${soldSound.currentSrc}`, 'info');
    });
    
    soldSound.addEventListener('loadeddata', () => {
      log('✓ Sold sound data loaded', 'success');
    });
    
    soldSound.addEventListener('error', (e) => {
      log('✗ Sold sound ERROR!', 'error');
      if (soldSound.error) {
        log(`  Error code: ${soldSound.error.code}`, 'error');
        log(`  Error message: ${soldSound.error.message}`, 'error');
      }
    });
    
    unsoldSound.addEventListener('canplaythrough', () => {
      log('✓ Unsold sound ready to play', 'success');
    });
    
    unsoldSound.addEventListener('error', (e) => {
      log('✗ Unsold sound ERROR!', 'error');
    });
    
    // Load audio
    soldSound.load();
    unsoldSound.load();
    
    log('Audio elements initialized and loading...', 'info');
    
    function testSoldSound() {
      log('--- Testing Sold Sound ---', 'info');
      log(`Ready state: ${soldSound.readyState}`, 'info');
      log(`Current time: ${soldSound.currentTime}`, 'info');
      log(`Duration: ${soldSound.duration}`, 'info');
      log(`Volume: ${soldSound.volume}`, 'info');
      log(`Muted: ${soldSound.muted}`, 'info');
      log(`Source: ${soldSound.currentSrc || 'Not loaded'}`, 'info');
      
      soldSound.currentTime = 0;
      
      const playPromise = soldSound.play();
      
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            log('✓ Sold sound PLAYING!', 'success');
          })
          .catch(e => {
            log(`✗ Error playing sold sound: ${e.name}`, 'error');
            log(`  Message: ${e.message}`, 'error');
            
            if (e.name === 'NotAllowedError') {
              log('⚠️ Audio blocked by browser autoplay policy', 'warning');
            } else if (e.name === 'NotSupportedError') {
              log('⚠️ Audio format not supported', 'warning');
            }
          });
      }
    }
    
    function testUnsoldSound() {
      log('--- Testing Unsold Sound ---', 'info');
      log(`Ready state: ${unsoldSound.readyState}`, 'info');
      
      unsoldSound.currentTime = 0;
      
      const playPromise = unsoldSound.play();
      
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            log('✓ Unsold sound PLAYING!', 'success');
          })
          .catch(e => {
            log(`✗ Error playing unsold sound: ${e.name}`, 'error');
          });
      }
    }
    
    // Unlock audio on first click
    document.addEventListener('click', function unlock() {
      log('Unlocking audio...', 'info');
      
      soldSound.play().then(() => {
        soldSound.pause();
        soldSound.currentTime = 0;
        log('✓ Sold audio unlocked', 'success');
      }).catch(e => {
        log(`⚠️ Sold unlock failed: ${e.name}`, 'warning');
      });
      
      unsoldSound.play().then(() => {
        unsoldSound.pause();
        unsoldSound.currentTime = 0;
        log('✓ Unsold audio unlocked', 'success');
      }).catch(e => {
        log(`⚠️ Unsold unlock failed: ${e.name}`, 'warning');
      });
      
      document.removeEventListener('click', unlock);
    }, { once: true });
  </script>
</body>
</html>
